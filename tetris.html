<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>图片版俄罗斯方块</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft Yahei", sans-serif;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #1a1a2e;
            color: white;
        }

        .game-container {
            display: flex;
            gap: 30px;
            align-items: flex-start;
        }

        /* 游戏画布样式 */
        #game-board {
            border: 3px solid #4a4a8a;
            background-color: #0f0f23;
            display: grid;
            grid-template-columns: repeat(10, 30px);
            grid-template-rows: repeat(20, 30px);
            gap: 1px;
        }

        /* 格子基础样式 */
        .cell {
            width: 30px;
            height: 30px;
            background-color: #14142c;
            overflow: hidden;
        }

        /* 方块图片样式 */
        .cell img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* 游戏信息面板 */
        .game-info {
            display: flex;
            flex-direction: column;
            gap: 20px;
            padding: 20px;
            background-color: #242448;
            border-radius: 10px;
            min-width: 200px;
        }

        .score-board {
            font-size: 18px;
        }

        .score-board span {
            color: #4cc9f0;
            font-size: 24px;
        }

        /* 控制按钮 */
        .controls {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        button {
            padding: 10px;
            border: none;
            border-radius: 5px;
            background-color: #4361ee;
            color: white;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        button:hover {
            background-color: #3a0ca3;
        }

        button:disabled {
            background-color: #555;
            cursor: not-allowed;
        }

        /* 下一个方块预览区 */
        .next-piece {
            display: grid;
            grid-template-columns: repeat(4, 30px);
            grid-template-rows: repeat(4, 30px);
            gap: 1px;
            background-color: #14142c;
            padding: 5px;
            border-radius: 5px;
        }

        .game-over {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.9);
            padding: 40px;
            border-radius: 10px;
            text-align: center;
            display: none;
        }

        .game-over h2 {
            color: #f72585;
            margin-bottom: 20px;
        }

        .instructions {
            font-size: 14px;
            color: #a0a0c0;
            line-height: 1.6;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- 游戏主面板 -->
        <div id="game-board"></div>
        
        <!-- 游戏信息面板 -->
        <div class="game-info">
            <h2>俄罗斯方块</h2>
            <div class="score-board">
                得分: <span id="score">0</span>
            </div>
            <div>
                <h3>下一个方块</h3>
                <div id="next-piece" class="next-piece"></div>
            </div>
            <div class="controls">
                <button id="start-btn">开始游戏</button>
                <button id="pause-btn" disabled>暂停游戏</button>
                <button id="reset-btn" disabled>重置游戏</button>
            </div>
            <div class="instructions">
                <p>操作说明：</p>
                <p>← →：左右移动</p>
                <p>↑：旋转方块</p>
                <p>↓：加速下落</p>
                <p>空格：直接下落</p>
            </div>
        </div>
    </div>

    <!-- 游戏结束弹窗 -->
    <div class="game-over" id="game-over">
        <h2>游戏结束！</h2>
        <p>最终得分: <span id="final-score">0</span></p>
        <button id="restart-btn">重新开始</button>
    </div>

    <script>
        // 游戏配置
        const config = {
            rows: 20,          // 行数
            cols: 10,          // 列数
            cellSize: 30,      // 格子大小(px)
            speed: 1000,       // 下落速度(ms)
            fastSpeed: 100     // 加速下落速度(ms)
        };

        // 方块类型定义 (使用本地图片路径，需替换为你的实际图片路径)
        // 注意：请将下面的图片路径替换为你本地的图片文件路径
        const pieceTypes = [
            // I型
            {
                shape: [
                    [0, 0, 0, 0],
                    [1, 1, 1, 1],
                    [0, 0, 0, 0],
                    [0, 0, 0, 0]
                ],
                image: 'images/block_i.png'  // 替换为你的I型方块图片路径
            },
            // J型
            {
                shape: [
                    [1, 0, 0],
                    [1, 1, 1],
                    [0, 0, 0]
                ],
                image: 'images/block_j.png'  // 替换为你的J型方块图片路径
            },
            // L型
            {
                shape: [
                    [0, 0, 1],
                    [1, 1, 1],
                    [0, 0, 0]
                ],
                image: 'images/block_l.png'  // 替换为你的L型方块图片路径
            },
            // O型
            {
                shape: [
                    [1, 1],
                    [1, 1]
                ],
                image: 'images/block_o.png'  // 替换为你的O型方块图片路径
            },
            // S型
            {
                shape: [
                    [0, 1, 1],
                    [1, 1, 0],
                    [0, 0, 0]
                ],
                image: 'images/block_s.png'  // 替换为你的S型方块图片路径
            },
            // T型
            {
                shape: [
                    [0, 1, 0],
                    [1, 1, 1],
                    [0, 0, 0]
                ],
                image: 'images/block_t.png'  // 替换为你的T型方块图片路径
            },
            // Z型
            {
                shape: [
                    [1, 1, 0],
                    [0, 1, 1],
                    [0, 0, 0]
                ],
                image: 'images/block_z.png'  // 替换为你的Z型方块图片路径
            }
        ];

        // 游戏状态
        let gameState = {
            board: [],         // 游戏面板数据
            currentPiece: null, // 当前方块
            nextPiece: null,   // 下一个方块
            score: 0,          // 得分
            isRunning: false,  // 游戏是否运行
            isPaused: false,   // 游戏是否暂停
            timer: null,       // 定时器
            speed: config.speed // 当前速度
        };

        // 初始化游戏面板
        function initBoard() {
            const board = document.getElementById('game-board');
            board.innerHTML = '';
            
            // 初始化数据面板
            gameState.board = Array(config.rows).fill().map(() => Array(config.cols).fill(null));
            
            // 创建视觉面板
            for (let row = 0; row < config.rows; row++) {
                for (let col = 0; col < config.cols; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.id = `cell-${row}-${col}`;
                    board.appendChild(cell);
                }
            }
        }

        // 生成随机方块
        function generateRandomPiece() {
            const randomIndex = Math.floor(Math.random() * pieceTypes.length);
            const pieceType = pieceTypes[randomIndex];
            
            // 计算初始位置（居中）
            const colOffset = Math.floor((config.cols - pieceType.shape[0].length) / 2);
            
            return {
                type: pieceType,
                row: 0,
                col: colOffset,
                rotation: 0
            };
        }

        // 渲染游戏面板
        function renderBoard() {
            // 清空所有格子
            for (let row = 0; row < config.rows; row++) {
                for (let col = 0; col < config.cols; col++) {
                    const cell = document.getElementById(`cell-${row}-${col}`);
                    cell.innerHTML = '';
                }
            }

            // 渲染固定的方块
            for (let row = 0; row < config.rows; row++) {
                for (let col = 0; col < config.cols; col++) {
                    if (gameState.board[row][col]) {
                        const cell = document.getElementById(`cell-${row}-${col}`);
                        const img = document.createElement('img');
                        img.src = gameState.board[row][col];
                        cell.appendChild(img);
                    }
                }
            }

            // 渲染当前方块
            if (gameState.currentPiece) {
                const { type, row: pieceRow, col: pieceCol } = gameState.currentPiece;
                const shape = type.shape;
                
                for (let r = 0; r < shape.length; r++) {
                    for (let c = 0; c < shape[r].length; c++) {
                        if (shape[r][c]) {
                            const boardRow = pieceRow + r;
                            const boardCol = pieceCol + c;
                            
                            if (boardRow >= 0 && boardRow < config.rows && boardCol >= 0 && boardCol < config.cols) {
                                const cell = document.getElementById(`cell-${boardRow}-${boardCol}`);
                                const img = document.createElement('img');
                                img.src = type.image;
                                cell.appendChild(img);
                            }
                        }
                    }
                }
            }

            // 更新得分显示
            document.getElementById('score').textContent = gameState.score;
        }

        // 渲染下一个方块预览
        function renderNextPiece() {
            const preview = document.getElementById('next-piece');
            preview.innerHTML = '';
            
            // 创建预览面板
            for (let row = 0; row < 4; row++) {
                for (let col = 0; col < 4; col++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    preview.appendChild(cell);
                }
            }

            if (gameState.nextPiece) {
                const { type } = gameState.nextPiece;
                const shape = type.shape;
                const cells = preview.querySelectorAll('.cell');
                
                // 居中显示
                const rowOffset = Math.floor((4 - shape.length) / 2);
                const colOffset = Math.floor((4 - shape[0].length) / 2);

                for (let r = 0; r < shape.length; r++) {
                    for (let c = 0; c < shape[r].length; c++) {
                        if (shape[r][c]) {
                            const index = (rowOffset + r) * 4 + (colOffset + c);
                            if (index < cells.length) {
                                const img = document.createElement('img');
                                img.src = type.image;
                                cells[index].appendChild(img);
                            }
                        }
                    }
                }
            }
        }

        // 检查碰撞
        function checkCollision(piece, offsetRow = 0, offsetCol = 0) {
            const { type, row, col } = piece;
            const shape = type.shape;

            for (let r = 0; r < shape.length; r++) {
                for (let c = 0; c < shape[r].length; c++) {
                    if (shape[r][c]) {
                        const newRow = row + r + offsetRow;
                        const newCol = col + c + offsetCol;

                        // 检查边界
                        if (newRow >= config.rows || newCol < 0 || newCol >= config.cols) {
                            return true;
                        }

                        // 检查是否与已固定的方块碰撞
                        if (newRow >= 0 && gameState.board[newRow][newCol]) {
                            return true;
                        }
                    }
                }
            }
            return false;
        }

        // 旋转方块
        function rotatePiece() {
            if (!gameState.currentPiece || !gameState.isRunning || gameState.isPaused) return;

            const currentPiece = { ...gameState.currentPiece };
            const shape = currentPiece.type.shape;
            
            // 旋转矩阵
            const rotatedShape = shape[0].map((_, index) => 
                shape.map(row => row[index]).reverse()
            );

            // 创建旋转后的临时方块
            const tempPiece = {
                ...currentPiece,
                type: {
                    ...currentPiece.type,
                    shape: rotatedShape
                },
                rotation: (currentPiece.rotation + 1) % 4
            };

            // 检查旋转后是否碰撞
            if (!checkCollision(tempPiece)) {
                gameState.currentPiece = tempPiece;
                renderBoard();
            }
        }

        // 移动方块
        function movePiece(direction) {
            if (!gameState.currentPiece || !gameState.isRunning || gameState.isPaused) return;

            let offsetCol = 0;
            
            switch(direction) {
                case 'left':
                    offsetCol = -1;
                    break;
                case 'right':
                    offsetCol = 1;
                    break;
                case 'down':
                    return dropPiece(); // 下落单独处理
            }

            // 检查移动是否碰撞
            if (!checkCollision(gameState.currentPiece, 0, offsetCol)) {
                gameState.currentPiece.col += offsetCol;
                renderBoard();
            }
        }

        // 方块下落
        function dropPiece() {
            if (!gameState.currentPiece || !gameState.isRunning || gameState.isPaused) return;

            // 检查是否可以下落
            if (!checkCollision(gameState.currentPiece, 1, 0)) {
                gameState.currentPiece.row += 1;
                renderBoard();
                return true;
            } else {
                // 无法下落，固定方块
                fixPiece();
                // 检查消除行
                clearLines();
                // 生成新方块
                spawnNewPiece();
                return false;
            }
        }

        // 直接下落到底部
        function hardDrop() {
            if (!gameState.currentPiece || !gameState.isRunning || gameState.isPaused) return;

            // 持续下落直到碰撞
            while (!checkCollision(gameState.currentPiece, 1, 0)) {
                gameState.currentPiece.row += 1;
            }
            
            fixPiece();
            clearLines();
            spawnNewPiece();
            renderBoard();
        }

        // 固定方块到面板
        function fixPiece() {
            const { type, row, col } = gameState.currentPiece;
            const shape = type.shape;

            for (let r = 0; r < shape.length; r++) {
                for (let c = 0; c < shape[r].length; c++) {
                    if (shape[r][c]) {
                        const boardRow = row + r;
                        const boardCol = col + c;
                        
                        if (boardRow >= 0 && boardRow < config.rows && boardCol >= 0 && boardCol < config.cols) {
                            gameState.board[boardRow][boardCol] = type.image;
                        }
                    }
                }
            }
        }

        // 消除满行
        function clearLines() {
            let linesCleared = 0;
            
            for (let row = config.rows - 1; row >= 0; row--) {
                // 检查行是否满
                if (gameState.board[row].every(cell => cell !== null)) {
                    linesCleared++;
                    
                    // 移除当前行
                    gameState.board.splice(row, 1);
                    // 在顶部添加空行
                    gameState.board.unshift(Array(config.cols).fill(null));
                    // 重新检查当前行（因为上面的行掉下来了）
                    row++;
                }
            }

            // 计算得分
            if (linesCleared > 0) {
                // 得分规则：1行100分，2行300分，3行500分，4行800分
                const scores = [0, 100, 300, 500, 800];
                gameState.score += scores[linesCleared];
                
                // 加速游戏（每消除10行速度提升10%）
                if (gameState.score % 1000 === 0 && gameState.speed > 200) {
                    gameState.speed = Math.floor(gameState.speed * 0.9);
                    restartTimer();
                }
            }
        }

        // 生成新方块
        function spawnNewPiece() {
            // 使用下一个方块作为当前方块
            gameState.currentPiece = gameState.nextPiece || generateRandomPiece();
            // 生成新的下一个方块
            gameState.nextPiece = generateRandomPiece();
            
            // 检查游戏结束（新方块刚生成就碰撞）
            if (checkCollision(gameState.currentPiece)) {
                gameOver();
                return;
            }
            
            // 渲染下一个方块预览
            renderNextPiece();
        }

        // 开始游戏
        function startGame() {
            // 重置游戏状态
            gameState = {
                board: [],
                currentPiece: null,
                nextPiece: generateRandomPiece(),
                score: 0,
                isRunning: true,
                isPaused: false,
                timer: null,
                speed: config.speed
            };

            // 初始化面板
            initBoard();
            // 生成第一个方块
            spawnNewPiece();
            // 渲染面板
            renderBoard();
            
            // 更新按钮状态
            document.getElementById('start-btn').disabled = true;
            document.getElementById('reset-btn').disabled = false;
            document.getElementById('pause-btn').disabled = false;
            document.getElementById('game-over').style.display = 'none';

            // 启动定时器
            startTimer();
        }

        // 暂停/继续游戏
        function togglePause() {
            if (!gameState.isRunning) return;

            gameState.isPaused = !gameState.isPaused;
            
            if (gameState.isPaused) {
                clearInterval(gameState.timer);
                document.getElementById('pause-btn').textContent = '继续游戏';
            } else {
                startTimer();
                document.getElementById('pause-btn').textContent = '暂停游戏';
            }
        }

        // 启动定时器
        function startTimer() {
            clearInterval(gameState.timer);
            gameState.timer = setInterval(() => {
                dropPiece();
            }, gameState.speed);
        }

        // 重启定时器
        function restartTimer() {
            if (gameState.isRunning && !gameState.isPaused) {
                startTimer();
            }
        }

        // 游戏结束
        function gameOver() {
            gameState.isRunning = false;
            clearInterval(gameState.timer);
            
            // 显示游戏结束弹窗
            document.getElementById('final-score').textContent = gameState.score;
            document.getElementById('game-over').style.display = 'block';
            
            // 更新按钮状态
            document.getElementById('start-btn').disabled = false;
            document.getElementById('pause-btn').disabled = true;
        }

        // 键盘控制
        function handleKeydown(e) {
            if (!gameState.isRunning || gameState.isPaused) return;

            switch(e.key) {
                case 'ArrowLeft':
                    movePiece('left');
                    break;
                case 'ArrowRight':
                    movePiece('right');
                    break;
                case 'ArrowUp':
                    rotatePiece();
                    break;
                case 'ArrowDown':
                    dropPiece();
                    break;
                case ' ':
                    hardDrop();
                    break;
            }
        }

        // 初始化事件监听
        function initEventListeners() {
            // 开始按钮
            document.getElementById('start-btn').addEventListener('click', startGame);
            
            // 重置按钮
            document.getElementById('reset-btn').addEventListener('click', startGame);
            
            // 暂停按钮
            document.getElementById('pause-btn').addEventListener('click', togglePause);
            
            // 重新开始按钮
            document.getElementById('restart-btn').addEventListener('click', startGame);
            
            // 键盘控制
            document.addEventListener('keydown', handleKeydown);
        }

        // 初始化游戏
        function initGame() {
            initBoard();
            initEventListeners();
            // 生成第一个下一个方块预览
            gameState.nextPiece = generateRandomPiece();
            renderNextPiece();
        }

        // 启动游戏
        window.addEventListener('load', initGame);
    </script>
</body>
</html>
