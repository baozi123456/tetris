<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>æ‰“åœ°é¼  - å®Œæ•´åŠŸèƒ½ç‰ˆ</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            text-align: center;
            background-color: #f0f0f0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            user-select: none;
        }

        h1 { margin: 10px 0; color: #333; }

        /* --- æ§åˆ¶é¢æ¿æ ·å¼ --- */
        .controls-panel {
            background: #fff;
            padding: 10px 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            margin-bottom: 15px;
            display: flex;
            gap: 20px;
            align-items: center;
            border: 1px solid #ddd;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .control-group label { font-size: 12px; color: #555; margin-bottom: 2px; }
        .control-group input[type="range"] { width: 120px; cursor: pointer; }
        .value-display { font-weight: bold; color: #d35400; font-family: monospace; }
        /* ------------------- */

        .info-board {
            display: flex;
            gap: 20px;
            font-size: 24px;
            margin-bottom: 10px;
            font-weight: bold;
            color: #444;
        }

        .btn-group {
            margin-bottom: 15px;
        }

        button {
            padding: 10px 25px;
            font-size: 18px;
            cursor: pointer;
            color: white;
            border: none;
            border-radius: 5px;
            margin: 0 5px;
            transition: background 0.2s;
        }

        #start-btn { background-color: #4CAF50; }
        #start-btn:disabled { background-color: #ccc; cursor: not-allowed; }
        #start-btn:hover:not(:disabled) { background-color: #45a049; }

        #reset-btn { background-color: #e74c3c; }
        #reset-btn:hover { background-color: #c0392b; }

        .game-board {
            display: grid;
            grid-template-columns: repeat(4, 1fr); 
            gap: 10px;
            width: 480px;
            height: 480px;
        }

        .hole {
            background-color: #8B4513;
            border-radius: 50%;
            position: relative;
            overflow: hidden;
            cursor: pointer; /* å³ä½¿æ²¡åœ°é¼ ï¼Œæ‰‹å‹ä¹Ÿæç¤ºå¯ä»¥ç‚¹å‡»(è§¦å‘Miss) */
            border: 4px solid #654321;
            box-shadow: inset 0 10px 20px rgba(0,0,0,0.5);
        }

        /* ç‚¹å‡»åœ°æ´æ—¶çš„è§†è§‰åé¦ˆ (å¯é€‰) */
        .hole:active {
            border-color: #503010;
        }

        .mole {
            width: 100%;
            height: 100%;
            background-color: #FFD700;
            border-radius: 50%;
            position: absolute;
            top: 100%;
            transition: top 0.1s;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 30px;
            color: #333;
            pointer-events: auto; /* ç¡®ä¿åœ°é¼ èƒ½æ¥æ”¶ç‚¹å‡» */
        }

        .hole.up .mole {
            top: 0;
        }
    </style>
</head>
<body>

    <h1>æ‰“åœ°é¼  (å®Œæ•´ç‰ˆ)</h1>

    <div class="controls-panel">
        <div class="control-group">
            <label>æœ€å¿«åœç•™ (ms)</label>
            <div>
                <input type="range" id="min-time-input" min="100" max="1500" step="50" value="400">
                <span class="value-display" id="min-time-display">400</span>
            </div>
        </div>
        <div class="control-group">
            <label>æœ€æ…¢åœç•™ (ms)</label>
            <div>
                <input type="range" id="max-time-input" min="200" max="2000" step="50" value="1000">
                <span class="value-display" id="max-time-display">1000</span>
            </div>
        </div>
    </div>

    <div class="info-board">
        <span>å¾—åˆ†: <span id="score">0</span></span>
        <span>æ—¶é—´: <span id="time-left">30</span>s</span>
    </div>

    <div class="btn-group">
        <button onclick="startGame()" id="start-btn">å¼€å§‹æ¸¸æˆ</button>
        <button onclick="resetGame()" id="reset-btn">é‡æ–°å¼€å§‹</button>
    </div>

    <div class="game-board">
        <div class="hole"><div class="mole">ğŸ­</div></div>
        <div class="hole"><div class="mole">ğŸ­</div></div>
        <div class="hole"><div class="mole">ğŸ­</div></div>
        <div class="hole"><div class="mole">ğŸ­</div></div>
        <div class="hole"><div class="mole">ğŸ­</div></div>
        <div class="hole"><div class="mole">ğŸ­</div></div>
        <div class="hole"><div class="mole">ğŸ­</div></div>
        <div class="hole"><div class="mole">ğŸ­</div></div>
        <div class="hole"><div class="mole">ğŸ­</div></div>
        <div class="hole"><div class="mole">ğŸ­</div></div>
        <div class="hole"><div class="mole">ğŸ­</div></div>
        <div class="hole"><div class="mole">ğŸ­</div></div>
        <div class="hole"><div class="mole">ğŸ­</div></div>
        <div class="hole"><div class="mole">ğŸ­</div></div>
        <div class="hole"><div class="mole">ğŸ­</div></div>
        <div class="hole"><div class="mole">ğŸ­</div></div>
    </div>

    <script>
        const holes = document.querySelectorAll('.hole');
        const moles = document.querySelectorAll('.mole');
        const scoreBoard = document.getElementById('score');
        const timeLeftBoard = document.getElementById('time-left');
        const startBtn = document.getElementById('start-btn');
        
        // æ§åˆ¶é¢æ¿
        const minTimeInput = document.getElementById('min-time-input');
        const maxTimeInput = document.getElementById('max-time-input');
        const minTimeDisplay = document.getElementById('min-time-display');
        const maxTimeDisplay = document.getElementById('max-time-display');

        let lastHole;
        let timeUp = false;
        let isPlaying = false; // æ–°å¢çŠ¶æ€ï¼šæ˜¯å¦æ­£åœ¨æ¸¸æˆä¸­
        let score = 0;
        let timeLeft = 30;
        
        // å…³é”®å˜é‡ï¼šç”¨äºå­˜å‚¨å®šæ—¶å™¨IDï¼Œä»¥ä¾¿Resetæ—¶æ¸…é™¤
        let countdownTimer;
        let peepTimeout; 

        // éŸ³æ•ˆèµ„æº
        // å‡»ä¸­ï¼šPopå£°
        const hitAudio = new Audio("https://www.soundjay.com/buttons/sounds/button-3.mp3");
        // æœªå‡»ä¸­ï¼šæŒ¥ç©ºå£° (Swish)
        const missAudio = new Audio("https://www.soundjay.com/misc/sounds/swish-1.mp3");

        // --- æ»‘å—ç›‘å¬ ---
        minTimeInput.addEventListener('input', function() {
            if(parseInt(this.value) > parseInt(maxTimeInput.value)) {
                maxTimeInput.value = this.value;
                maxTimeDisplay.textContent = this.value;
            }
            minTimeDisplay.textContent = this.value;
        });

        maxTimeInput.addEventListener('input', function() {
            if(parseInt(this.value) < parseInt(minTimeInput.value)) {
                minTimeInput.value = this.value;
                minTimeDisplay.textContent = this.value;
            }
            maxTimeDisplay.textContent = this.value;
        });

        // --- æ¸¸æˆé€»è¾‘ ---

        function randomTime(min, max) {
            return Math.round(Math.random() * (max - min) + min);
        }

        function randomHole(holes) {
            const idx = Math.floor(Math.random() * holes.length);
            const hole = holes[idx];
            if (hole === lastHole) return randomHole(holes);
            lastHole = hole;
            return hole;
        }

        function peep() {
            const min = parseInt(minTimeInput.value);
            const max = parseInt(maxTimeInput.value);
            const time = randomTime(min, max);
            const hole = randomHole(holes);
            
            hole.classList.add('up');

            // å°† setTimeout èµ‹å€¼ç»™å˜é‡ï¼Œä»¥ä¾¿ reset æ—¶æ¸…é™¤
            peepTimeout = setTimeout(() => {
                hole.classList.remove('up');
                if (!timeUp) peep();
            }, time);
        }

        function startGame() {
            // é˜²æ­¢é‡å¤å¯åŠ¨
            if (isPlaying) return;
            
            resetVariables();
            isPlaying = true;
            startBtn.disabled = true;
            startBtn.textContent = "æ¸¸æˆä¸­...";

            peep();

            countdownTimer = setInterval(() => {
                timeLeft--;
                timeLeftBoard.textContent = timeLeft;
                if (timeLeft <= 0) {
                    gameOver();
                }
            }, 1000);
        }

        function resetVariables() {
            scoreBoard.textContent = 0;
            timeLeftBoard.textContent = 30;
            score = 0;
            timeLeft = 30;
            timeUp = false;
        }

        function gameOver() {
            clearInterval(countdownTimer);
            clearTimeout(peepTimeout); // åœæ­¢åœ°é¼ å†’å¤´
            timeUp = true;
            isPlaying = false;
            startBtn.disabled = false;
            startBtn.textContent = "å¼€å§‹æ¸¸æˆ";
            // ç§»é™¤æ‰€æœ‰å¯èƒ½è¿˜å¡åœ¨ä¸Šé¢çš„åœ°é¼ 
            holes.forEach(hole => hole.classList.remove('up'));
            alert('æ—¶é—´åˆ°ï¼æœ€ç»ˆå¾—åˆ†ï¼š' + score);
        }

        // æ–°å¢ï¼šé‡æ–°å¼€å§‹åŠŸèƒ½
        function resetGame() {
            // 1. åœæ­¢æ‰€æœ‰å®šæ—¶å™¨
            clearInterval(countdownTimer);
            clearTimeout(peepTimeout);
            
            // 2. æ¸…ç†ç•Œé¢çŠ¶æ€
            holes.forEach(hole => hole.classList.remove('up'));
            
            // 3. é‡ç½®å˜é‡å¹¶å¼ºåˆ¶å¼€å§‹
            isPlaying = false; // å…ˆè®¾ä¸ºfalseä»¥å…è®¸startGameè¿è¡Œ
            timeUp = false;
            
            // 4. ç«‹å³å¼€å§‹æ–°æ¸¸æˆ
            startGame();
        }

        // --- ç‚¹å‡»äº‹ä»¶å¤„ç† ---

        // 1. å‡»ä¸­åœ°é¼ é€»è¾‘
        function bonk(e) {
            if(!e.isTrusted) return; 
            // é˜»æ­¢äº‹ä»¶å†’æ³¡ï¼šè¿™æ„å‘³ç€ç‚¹å‡»äº†åœ°é¼ åï¼Œä¸ä¼šå†è§¦å‘ä¸‹é¢åœ°æ´çš„ç‚¹å‡»äº‹ä»¶
            e.stopPropagation(); 
            
            // åªæœ‰å½“åœ°é¼ æ˜¯"up"çŠ¶æ€æ—¶æ‰ç®—åˆ†
            if (this.parentNode.classList.contains('up')) {
                hitAudio.currentTime = 0;
                hitAudio.play().catch(() => {});
                score++;
                this.parentNode.classList.remove('up');
                scoreBoard.textContent = score;
            }
        }

        // 2. æœªå‡»ä¸­ï¼ˆMissï¼‰é€»è¾‘
        function miss(e) {
            if(!e.isTrusted) return;
            
            // åªæœ‰åœ¨æ¸¸æˆè¿›è¡Œä¸­ç‚¹å‡»æ‰ç®—Miss
            if (isPlaying && !timeUp) {
                missAudio.currentTime = 0;
                missAudio.play().catch(() => {});
                // ä½ å¯ä»¥åœ¨è¿™é‡ŒåŠ æ‰£åˆ†é€»è¾‘ï¼Œä¾‹å¦‚ï¼š
                // score--; 
                // scoreBoard.textContent = score;
                
                // è§†è§‰åé¦ˆï¼šMissæ—¶åœ°æ´é—ªä¸€ä¸‹çº¢è‰²ï¼ˆå¯é€‰ï¼‰
                this.style.backgroundColor = '#5a2d0c';
                setTimeout(() => { this.style.backgroundColor = '#8B4513'; }, 100);
            }
        }

        // ç»‘å®šäº‹ä»¶
        moles.forEach(mole => mole.addEventListener('click', bonk));
        holes.forEach(hole => hole.addEventListener('click', miss));

    </script>
</body>
</html>